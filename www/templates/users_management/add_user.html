{% extends "../base.html" %}

{% block title %}ВолКомХоз: Добавление пользователя{% end %}

{% block body %}

<div class="container-fluid">
	<h2 style="margin:10px 0 20px 0">Добавление нового пользователя</h2>
	<form id="add_user_form" method="post">

		<!-- форма ИМЯ -->
		<div class="form-group col-md-6" style="float: none">
			<label class="control-label" for="name_new_user">
					Имя
			</label>
			<div class="input-group col-md-12">
				<span class="input-group-addon">
					<i class="glyphicon glyphicon-user"></i>
				</span>
				<input type="text" class="form-control" id="name_new_user" name="name" placeholder="Имя" pattern="^[A-Za-zА-Яа-яЁё0-9]+(?:[ _-][A-Za-zА-Яа-яЁё0-9]+)*$" required>
			</div>
		</div>

		<!-- форма EMAIL -->
		<div class="form-group col-md-6" style="float: none">
			<label class="control-label" for="email_new_user">
					Email
			</label>
			<div class="input-group col-md-12">
				<span class="input-group-addon" role="input">
					<i class="glyphicon glyphicon-envelope"></i>
				</span>
				<input type="email" class="form-control" id="email_new_user" name="email" placeholder="Email" required>
			</div>
		</div>

		<!-- форма ПАРОЛЬ -->
		<div class="form-group col-md-6" style="float: none">
			<label class="control-label" for="password_new_user">
					Пароль
			</label>
			<div class="input-group col-md-12">
				<span class="input-group-addon">
					<i class="glyphicon glyphicon-lock"></i>
				</span>
				<input type="password" class="form-control" id="password_new_user" name="password" placeholder="Пароль"  required>
			</div>
		</div>

		<!-- форма ПОДТВЕРЖДЕНИЯ ПАРОЛЯ -->
		<div class="form-group col-md-6" style="float: none">
			<label class="control-label" for="confirm_password_new_user">
					Повторите пароль
			</label>
			<div class="input-group col-md-12">
				<span class="input-group-addon">
					<i class="glyphicon glyphicon-lock"></i>
				</span>
				<input type="password" class="form-control" id="confirm_password_new_user" name="confirm_password" placeholder="Повторите пароль" required>
			</div>
		</div>

		<!-- форма ПРАВ ДОСТУПА -->
		<div class="form-group col-md-6" style="float: none;">
			<table class="col-md-12" style="float: none">
				<tr>
				{% for index, key in enumerate(pers) %}
					<td><div class="checkbox">
						<label>
							<input type="hidden" id="{{ key }}_hidden" name="{{ key }}" value="False">
							<input type="checkbox" id="{{ key }}_showen" name="{{ key }}" value="True">{{ pers[key][1] }} : {{ hex(pers[key][0]) }}
						</label>
					</div></td>
					{% if index % 2%}
			    		</tr>
			    		<tr>
				    {% end %}
				{% end %}
				</tr>
			</table>
		</div>

		<!-- кнопки -->
		<div class="col-md-6">
			<a href="/users_management" class="btn btn-default">Отменить</a>
			<button type="submit" class="btn btn-default">Добавить</button>
		</div>
	</form>
	<script>
		var name_input = document.getElementById("name_new_user");
		
		MAX_NAME_LENGTH = 65535;
		function ValidateName(){
			var value = name_input.value;
			var pattern = new RegExp(name_input.pattern);
			if (value.length > MAX_NAME_LENGTH) {
				name_input.setCustomValidity("Длина поля должна быть меньше " + MAX_NAME_LENGTH + "!");
			} 
			else if (!pattern.test(value)) {
				name_input.setCustomValidity("Имя может состоять из латинских букв, русских букв, цифр, пробела, нижнего подчеркивания и тире, причем начинаться должно с буквы или цифры!");
			}
			else {
				name_input.setCustomValidity('');
			}
		}

		name_input.onkeyup = ValidateName;

	</script>
	<script>
		var password = document.getElementById("password_new_user");
		var confirm_password = document.getElementById("confirm_password_new_user");

		function ValidatePassword(){
			if(password.value != confirm_password.value) {
				confirm_password.setCustomValidity("Пароли не совпадают!");
			} else {
				confirm_password.setCustomValidity('');
			}
		}

		password.onchange = ValidatePassword;
		confirm_password.onkeyup = ValidatePassword;

	</script>
	<script>
		$('#test2').click(function() {
			$('input[type=checkbox]').each(function () {
				if($(this).is(':checked')) {
					$(this).siblings().prop('disabled', true);
				}
			})
			return false;
		});
	</script>
</div>

{% end %}